---
title: K8S_architecture_etcd
tags:
  - kubernetes
date: 2024_04_25
Modify_Date: 
reference:
---
# K8S_architecture_etcd

모든 오브젝트(Pod, Replicas, Service, Secret 등) 는 API 서버가 다시 시작되거나 실패하더라도 유지하기 위해 매니페스트가 영구적으로 저장될 필요가 있습니다. 이를 위해 쿠버네티스는 빠르고, 분산되어 저장되며, 키-값 구조의 저장소를 제공하는 etcd를 사용합니다.
**쿠버네티스 API 서버만이 etcd와 직접적으로 통신하는 유일한 구성 요소 입니다.** 다른 구성 요소는 API 서버로 간접적으로 데이터에 접근합니다.
이를통해 낙관적 잠금 시스템뿐만 아니라 유효성 검사를 하는등의 이점을 얻습니다.
쿠버네티스가 클러스터 상태와 메타데이터를 저장하는 유일한 장소가 etcd 라는 것은 매우 중요한 정보입니다.


> [!NOTE] 낙관적 동시성 제어(Optimistic Concurrency Contro) 이란?
> 	낙관적 동시성 제어는 데이터 조각에 잠금을 설정해 그동안 데이터를 잃거나 업데이트를 하지 못하게 하는 대신, 데이터에 버전 번호를 포함하는 방법이다. 데이터가 업데이트 될 때마다 버전번호는 증가된다. 데이터를 업데이트할 때, 클라이언트가 데이터를 읽은 시간과 업데이트를 제출하는 시간 사이에 버전 정보가 증가했는지 여부를 체크한다. 만약에 버전 정보가 증가했다면 수정된 내용은 거부되고 클라이언트는 다시 새 데이터를 읽고, 다시 업데이트를 시도해야 한다.
> 	결과적으로 두 클라이언트가 동일한 데이터 항목을 업데이트 시도시 성공한다.
> 	모든 쿠버네티스 리소스에는 클라이언트가 오브젝트를 업데이트할때 API 서버로 같이 넘겨줘야 하는 metadata.resourceVersion 필드가 있다. 만약 etcd에 저장되어 있는 버전과 일치하지 않을 경우 API 서버는 수정 요청을 거부한다.


