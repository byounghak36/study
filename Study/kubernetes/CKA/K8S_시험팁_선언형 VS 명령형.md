---
title: K8S_ì„ ì–¸í˜•VSëª…ë ¹í˜•_ì‹œí—˜íŒ
tags:
  - kubernetes
  - CKA
date: 2024_05_16
reference: 
link:
  - https://seongjin.me/kubernetes-imparative-vs-declarative/
---
# ì¸ì¦ íŒ - Kubectlì„ ì‚¬ìš©í•œ ëª…ë ¹í˜• ëª…ë ¹ì–´

ëŒ€ë¶€ë¶„ ì„ ì–¸ì  ë°©ë²•, ì¦‰ ì •ì˜ íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ” ì‘ì—…ì„ í•˜ê² ì§€ë§Œ, ëª…ë ¹í˜• ëª…ë ¹ì–´ëŠ” í•œ ë²ˆì˜ ì‘ì—…ì„ ë¹ ë¥´ê²Œ ì™„ë£Œí•˜ê±°ë‚˜ ì •ì˜ í…œí”Œë¦¿ì„ ì‰½ê²Œ ìƒì„±í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‹œí—˜ ì¤‘ì— ìƒë‹¹í•œ ì‹œê°„ì„ ì ˆì•½í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì‹œì‘í•˜ê¸° ì „ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ë•Œ ìœ ìš©í•  ìˆ˜ ìˆëŠ” ë‘ ê°€ì§€ ì˜µì…˜ì„ ìˆ™ì§€í•˜ì‹­ì‹œì˜¤:

`--dry-run`: ê¸°ë³¸ì ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤. ë‹¨ìˆœíˆ ëª…ë ¹ì–´ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ë‹¤ë©´ `--dry-run=client` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤. ì´ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ , ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ”ì§€ì™€ ëª…ë ¹ì–´ê°€ ì˜¬ë°”ë¥¸ì§€ë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤.
`-o yaml`: ì´ëŠ” í™”ë©´ì— YAML í˜•ì‹ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ì •ì˜ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.

ìœ„ ë‘ ê°€ì§€ë¥¼ ì¡°í•©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ì •ì˜ íŒŒì¼ì„ ë¹ ë¥´ê²Œ ìƒì„±í•œ í›„ ìˆ˜ì •í•˜ì—¬ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” íŒŒì¼ì„ ì²˜ìŒë¶€í„° ë§Œë“œëŠ” ëŒ€ì‹  ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì˜µì…˜ ì‚¬ìš© ë°©ë²•

#### 1.Â `--dry-run = none`
ì‹¤ì œë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê³  ë³€ê²½ì„ API ì„œë²„ì— ì ìš©í•©ë‹ˆë‹¤. ì´ê²ƒì€Â `dry-run`ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í–‰ë™ê³¼ ë™ì¼í•©ë‹ˆë‹¤.

#### 2.Â `--dry-run = client`

`Kubernetes API`Â ì„œë²„ì— ì–´ë– í•œ ìš”ì²­ë„ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ì‹¤ì œ ì„œë²„ì˜ ìœ íš¨ì„± ê²€ì‚¬ë‚˜ ê¸°íƒ€ ë¡œì§ì€ ìˆ˜í–‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ëª…ë ¹ì´ ì‹¤ì œë¡œ ì‹¤í–‰ë  ë•Œì™€ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 3.Â `--dry-run = server`

ì´ ì˜µì…˜ì€ ëª…ë ¹ì„ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì²˜ëŸ¼Â `Kubernetes API ì„œë²„`ì— ìš”ì²­ì„ ì „ì†¡í•©ë‹ˆë‹¤.
ì„œë²„ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì˜ˆìƒë˜ëŠ” ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ë³€ê²½ì‚¬í•­ì€ ì €ì¥ë˜ê±°ë‚˜ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´, ì„œë²„ì˜ ìœ íš¨ì„± ê²€ì‚¬, ê¸°ë³¸ ê°’ ì„¤ì •, ê¸°íƒ€ ìš”ì²­ ì²˜ë¦¬ ë¡œì§ì„ í¬í•¨í•œ ì‹¤ì œ ëª…ë ¹ ì²˜ë¦¬ì˜ ì „ì²´ ë¼ì´í”„ì‚¬ì´í´ì„ ì‹œë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
### client vs server
ğŸ¤“clientì™€ serverì˜ ê²½ìš° ì´í•´ê°€ ë˜ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ ê°„ë‹¨í•˜ê²Œ ë§í•´ì„œ ê°’ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ íŒŒë“œë¥¼ ìƒì„±í•œë‹¤ê³  ê°€ì •í•  ë•Œ client ì˜µì…˜ì€ ë¬¸ì œê°€ ì—†ëŠ” ê²ƒ ì²˜ëŸ¼ ë‚˜ì˜¤ì§€ë§Œ serverë¡œ ì‹¤í–‰í•˜ë©´ ì—ëŸ¬ë¥¼ ê°ì§€í•˜ê²Œ ë©ë‹ˆë‹¤.
ğŸ¤—ìƒí™©ì— ë”°ë¼ í•„ìš”í•œì‹  ì˜µì…˜ì„ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•˜ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.


### ì‚¬ìš© ì˜ˆì‹œ
#### POD
**NGINX Pod ìƒì„±**
`kubectl run nginx --image=nginx`

**POD ë§¤ë‹ˆí˜ìŠ¤íŠ¸ YAML íŒŒì¼ ìƒì„±(-o yaml). ìƒì„±í•˜ì§€ ì•ŠìŒ(--dry-run)**
`kubectl run nginx --image=nginx --dry-run=client -o yaml`

#### Deployment
**ë””í”Œë¡œì´ë¨¼íŠ¸ ìƒì„±**
`kubectl create deployment --image=nginx nginx`

**ë””í”Œë¡œì´ë¨¼íŠ¸ YAML íŒŒì¼ ìƒì„±(-o yaml). ìƒì„±í•˜ì§€ ì•ŠìŒ(--dry-run)**
`kubectl create deployment --image=nginx nginx --dry-run=client -o yaml`

**4ê°œì˜ ë ˆí”Œë¦¬ì¹´ë¡œ ë””í”Œë¡œì´ë¨¼íŠ¸ ìƒì„±**
`kubectl create deployment nginx --image=nginx --replicas=4`

ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ í™•ì¥í•˜ë ¤ë©´ `kubectl scale` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`kubectl scale deployment nginx --replicas=4`

**ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ YAML ì •ì˜ë¥¼ íŒŒì¼ì— ì €ì¥í•˜ê³  ìˆ˜ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤**
`kubectl create deployment nginx --image=nginx --dry-run=client -o yaml > nginx-deployment.yaml`

ê·¸ëŸ° ë‹¤ìŒ YAML íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ ë ˆí”Œë¦¬ì¹´ ë˜ëŠ” ë‹¤ë¥¸ í•„ë“œë¥¼ ìˆ˜ì •í•œ í›„ ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Service
**Pod redisë¥¼ í¬íŠ¸ 6379ë¡œ ë…¸ì¶œí•˜ëŠ” ClusterIP íƒ€ì…ì˜ redis-service ìƒì„±**
`kubectl expose pod redis --port=6379 --name redis-service --dry-run=client -o yaml`
(ì´ëŠ” ìë™ìœ¼ë¡œ podì˜ ë¼ë²¨ì„ ì…€ë ‰í„°ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤)

`kubectl create service clusterip redis --tcp=6379:6379 --dry-run=client -o yaml` 
(ì´ëŠ” podì˜ ë¼ë²¨ì„ ì…€ë ‰í„°ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ëŒ€ì‹  **app=redis**ë¡œ ì…€ë ‰í„°ë¥¼ ê°€ì •í•©ë‹ˆë‹¤. [ì„ íƒ ì˜µì…˜ìœ¼ë¡œ ì…€ë ‰í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.](https://github.com/kubernetes/kubernetes/issues/46191) ë”°ë¼ì„œ podì— ë‹¤ë¥¸ ë¼ë²¨ì´ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²½ìš° ì˜ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. íŒŒì¼ì„ ìƒì„±í•œ í›„ ì…€ë ‰í„°ë¥¼ ìˆ˜ì •í•œ ë‹¤ìŒ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•˜ì‹­ì‹œì˜¤.)

**Pod nginxì˜ í¬íŠ¸ 80ì„ ë…¸ë“œì˜ í¬íŠ¸ 30080ìœ¼ë¡œ ë…¸ì¶œí•˜ëŠ” NodePort íƒ€ì…ì˜ nginx ì„œë¹„ìŠ¤ ìƒì„±**
`kubectl expose pod nginx --type=NodePort --port=80 --name=nginx-service --dry-run=client -o yaml`
(ì´ëŠ” ìë™ìœ¼ë¡œ podì˜ ë¼ë²¨ì„ ì…€ë ‰í„°ë¡œ ì‚¬ìš©í•˜ì§€ë§Œ, [ë…¸ë“œ í¬íŠ¸ë¥¼ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤](https://github.com/kubernetes/kubernetes/issues/25478). ì •ì˜ íŒŒì¼ì„ ìƒì„±í•œ í›„ ë…¸ë“œ í¬íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•œ ë‹¤ìŒ podë¡œ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.)

`kubectl create service nodeport nginx --tcp=80:80 --node-port=30080 --dry-run=client -o yaml`
(ì´ëŠ” podì˜ ë¼ë²¨ì„ ì…€ë ‰í„°ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤)

ìœ„ ëª…ë ¹ì–´ë“¤ì€ ê°ê°ì˜ ë„ì „ ê³¼ì œê°€ ìˆìŠµë‹ˆë‹¤. í•˜ë‚˜ëŠ” ì…€ë ‰í„°ë¥¼ í—ˆìš©í•  ìˆ˜ ì—†ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ë…¸ë“œ í¬íŠ¸ë¥¼ í—ˆìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. `kubectl expose` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. ë…¸ë“œ í¬íŠ¸ë¥¼ ì§€ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°, ë™ì¼í•œ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜ íŒŒì¼ì„ ìƒì„±í•œ í›„ ë…¸ë“œ í¬íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•œ ë‹¤ìŒ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•˜ì‹­ì‹œì˜¤.

#### **ì°¸ì¡°:**
[https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands)
[https://kubernetes.io/docs/reference/kubectl/conventions/](https://kubernetes.io/docs/reference/kubectl/conventions/)